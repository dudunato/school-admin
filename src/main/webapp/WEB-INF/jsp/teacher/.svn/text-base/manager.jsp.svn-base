<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<%@ taglib prefix="tiles" uri="http://tiles.apache.org/tags-tiles"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>  

<tiles:insertTemplate template="/default.jsp">

<tiles:putAttribute name="head">
<style type="text/css">

#panel{
	color: #003366;
    font-size: 13px;
    margin: 2% auto auto;
    padding-bottom: 15px;
    position: relative;
    width: 930px;
}

.fieldsetclass {
	border: 1px solid #CCCCCC;
    border-radius: 4px 4px 4px 4px;
    height: 100%;
    margin: auto;
    padding: 10px;
    width: 800px;
    margin-top: 10px;
}

#tbteachers{
	border-collapse: collapse;
    text-align: center;
    width: 100%;
}

#tbteachers_wrapper{
	margin: 20px auto auto;
    width: 822px;
}

#tbteachers_length{
	float: left;
	margin: 4px;
}

#tbteachers_filter{
	float: right;
    margin: 4px;
}

#tbteachers_info{
	float: left;
	margin: 4px;
}

#tbteachers_paginate{
	float: right;
    margin: 4px;
}

table thead th div.DataTables_sort_wrapper {
	position: relative;
	padding-right: 20px;
	padding-right: 20px;
	cursor: pointer;
}

table thead th div.DataTables_sort_wrapper span {
	position: absolute;
	top: 50%;
	margin-top: -8px;
	right: 0;
}

table#tbteachers tbody tr:nth-child(odd) {
	background-color: #FFFFFF;
}

table#tbteachers tbody tr:nth-child(even) {
	background-color: #E8E8E8;
}

table#tbteachers tbody tr:nth-child(odd):hover,table#tbteachers tbody tr:nth-child(even):hover{
	background-color: #539FEC;
	color: #ffffff;
}

legend {
	color: #003366;
    font-size: 15px;
    margin: 2px;
}

</style>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/jquery.maskedinput-1.2.2.min.js"></script>
<script type="text/javascript">

function ModuleController(){ DJR.call(this); }
ModuleController.prototype.routes = {
	"save":{
		url: "${pageContext.request.contextPath}/module/save", method: "POST"
	},
	"edit":{
		url: "${pageContext.request.contextPath}/module/edit", method: "POST"
	},
	"del":{
		url: "${pageContext.request.contextPath}/module/delete", method: "POST"
	}
}

var controller = new ModuleController();

$(function() {
	
	$('#tbteachers').dataTable({
		"bJQueryUI": true,
		"oLanguage": {
			"sSearch": "Busca:",
			"sInfo": "_START_ à _END_ de _TOTAL_ Módulos",
			"sLengthMenu": "Mostrar _MENU_ ",
			"sEmptyTable": "Não existe professores cadastrados.",
			"sZeroRecords": "Nenhum professor encontrado.",
			"sInfoFiltered": ""
		},
		"aoColumnDefs" : [ {
			"bSortable" : false,
			"aTargets" : [ 4 ]
		} ],
	});
	
	$('.mandatory').keypress(function(e) {
		$(this).removeClass("text ui-widget-content ui-corner-all ui-state-error").addClass("text ui-widget-content ui-corner-all");
	});
	
	$("#birth").datepicker({
		dateFormat:"dd/mm/yy",
		changeMonth: true,
		changeYear: true,
		yearRange: '-100y:c+nn',
        maxDate: '-1d',
		showOn : "button",
		buttonImage : "${pageContext.request.contextPath}/images/calendar.png",
		buttonImageOnly : true
	});

	
	$("#cpf").mask("999.999.999-99");
	$("#tel").mask("(99)9999-9999");
	$("#cep").mask("99999-999");
	$("#number").mask("9?999");
});

function save(){
	var name = $("#name").val();
	var user = $("#user").val();
	var pass = $("#pass").val();
	
	if (validations(name,user,pass)) {
		$("#msgDesc").text("Deseja cadastrar este Módulo?");
		$("#boxMsg").dialog({
			resizable: false,
			height:180,
			modal: true,
			buttons: {
				Ok: function() {
					
					$('#loader').css('display', 'block');
					controller.save(
							{"module":{
						            "name": name,
						            "username": user,
						            "password": pass
						            }
						    },
						    function(data){
						    	if(data.string == "success"){
						    		$('#loader').hide();
						    		$("#msgDesc").text("Módulo cadastrado com sucesso.");
						    		$("#boxMsg").dialog({
						    			resizable: false,
						    			height:180,
						    			modal: true,
						    			buttons: {
						    				Ok: function() {
						    					clearFields();
						    					$(this).dialog( "close" );
						    					location.reload();
						    				}
						    			}
						    		});
						    	}else{
						    		$("#msgDesc").text("Houve um erro ao cadastrar o Módulo.");
						    		$("#boxMsg").dialog({
						    			resizable: false,
						    			height:180,
						    			modal: true,
						    			buttons: {
						    				Ok: function() {
						    					$(this).dialog( "close" );
						    				}
						    			}
						    		});
						    	}
						    }
					);
				},
				Cancel: function () {
					$(this).dialog( "close" );
				}
			}
		});	
	}
}

function edit(){
	var id = $("#idEdit").val();
	var name = $("#nameEdit").val();
	var user = $("#userEdit").val();
	var pass = $("#passEdit").val();
	
	if (validations(name,user,pass)) {
		$("#msgDesc").text("Deseja editar este Módulo?");
		$("#boxMsg").dialog({
			resizable: false,
			height:180,
			modal: true,
			buttons: {
				Ok: function() {
					
					$('#loader').css('display', 'block');
					controller.edit(
							{"module":{
									"id" : id,
						            "name": name,
						            "username": user,
						            "password": pass
						            }
						    },
						    function(data){
						    	if(data.string == "success"){
						    		$('#loader').hide();
						    		$("#msgDesc").text("Módulo editado com sucesso.");
						    		$("#boxMsg").dialog({
						    			resizable: false,
						    			height:180,
						    			modal: true,
						    			buttons: {
						    				Ok: function() {
						    					clearFields();
						    					$('#fieldsetEdit').hide();$('#fieldsetCad').show('slide', 120);
						    					$(this).dialog( "close" );
						    					location.reload();
						    				}
						    			}
						    		});
						    	}else{
						    		$("#msgDesc").text("Houve um erro ao editar o Módulo.");
						    		$("#boxMsg").dialog({
						    			resizable: false,
						    			height:180,
						    			modal: true,
						    			buttons: {
						    				Ok: function() {
						    					$(this).dialog( "close" );
						    				}
						    			}
						    		});
						    	}
						    }
					);
				},
				Cancel: function () {
					$(this).dialog( "close" );
				}
			}
		});	
	}
}

function del(n){
	var id = $('#idtd' + n).text();
	
	$("#msgDesc").text("Deseja deletar este Módulo?");
	$("#boxMsg").dialog({
		resizable: false,
		height:180,
		modal: true,
		buttons: {
			Ok: function() {
				
				$('#loader').css('display', 'block');
				controller.del(
						{
							"id" : id,
					    },
					    function(data){
					    	if(data.string == "success"){
					    		$('#loader').hide();
					    		$("#msgDesc").text("Módulo deletado com sucesso.");
					    		$("#boxMsg").dialog({
					    			resizable: false,
					    			height:180,
					    			modal: true,
					    			buttons: {
					    				Ok: function() {
					    					clearFields();
					    					$(this).dialog( "close" );
					    					location.reload();
					    				}
					    			}
					    		});
					    	}else{
					    		$('#loader').hide();
					    		$("#msgDesc").text("Houve um erro ao deletar o Módulo.");
					    		$("#boxMsg").dialog({
					    			resizable: false,
					    			height:180,
					    			modal: true,
					    			buttons: {
					    				Ok: function() {
					    					$(this).dialog( "close" );
					    				}
					    			}
					    		});
					    	}
					    }
				);
			},
			Cancel: function () {
				$(this).dialog( "close" );
			}
		}
	});
}

function switchEdit(n){
	clearFields();
	
	$('#nameEdit').val($('#tdname' + n).text());
	$('#rgEdit').val($('#tdrg' + n).val());
	$('#cpfEdit').val($('#tdcpf' + n).text());
	$('#birthEdit').val($('#tdbirth' + n).val());
	$('#specEdit').val($('#tdspec' + n).val());
	$('#meiEdit').val($('#tdmei' + n).val());
	$('#emailEdit').val($('#tdemail' + n).text());
	$('#telEdit').val($('#tdtel' + n).val());
	$('#cepEdit').val($('#tdcep' + n).val());
	$('#endEdit').val($('#tdend' + n).val());
	$('#numberEdit').val($('#tdnumber' + n).val());
	$('#neighborhoodEdit').val($('#tdneighborhood' + n).val());
	$('#obsEdit').val($('#tdobs' + n).val());
	
	$('#fieldsetCad').hide();
	$('#fieldsetEdit').show('slide', 150);
}

function validations(){
	
	var val = 0;
	
	$("fieldset input[type='text'], select").each(function(){
	    if($(this).val() == "" || $(this).val() == "-1"){
	        if($(this).hasClass('mandatory')){
		        $(this).addClass("ui-state-error");
		        val++;
	        }
	    }
	});
	
	
	if(val != 0){
		$("#msgDesc").text("Preencha os campos obrigatórios (*).");
		$("#boxMsg").dialog({
			resizable: false,
			height:180,
			modal: true,
			buttons: {
				Ok: function() {
					$(this).dialog( "close" );
				}
			}
		});
		
		return false;
	}
	
	if(!$.validateEmail($('#email').val())){
		$('#email').addClass("ui-state-error");
		
		$("#msgDesc").text("Email inválido.");
		$("#boxMsg").dialog({
			resizable: false,
			height:180,
			modal: true,
			buttons: {
				Ok: function() {
					$(this).dialog( "close" );
					$('#email').focus();
				}
			}
		});
		
		return false;
	}
	
	return true;
}

$.validateEmail = function (email){

    er = /^[a-zA-Z0-9][a-zA-Z0-9\._-]+@([a-zA-Z0-9\._-]+\.)[a-zA-Z-0-9]{2}/;

    if(er.exec(email))
        return true;
    else
        return false;

};


function clearFields(){
	$('input:text, input:password').val('');
	$('input:text, input:password').removeClass("text ui-widget-content ui-corner-all ui-state-error").addClass("text ui-widget-content ui-corner-all");
}
</script>

</tiles:putAttribute>

<tiles:putAttribute name="content">

	<div id="panel" class="ui-dialog ui-widget ui-widget-content ui-corner-all  ui-draggable ui-resizable" >
		<div  class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix" style="height: 30px; cursor: auto;">
			<span class="ui-dialog-title"  style="float: right;font-size: 28px;margin-top: -2px;padding-right: 285px;">Gerenciar Professores</span>						
		</div>
		
		<fieldset id="fieldsetCad" class="fieldsetclass">
			<legend>Cadastrar Professor</legend>
			
			<label style="display: block;float: left;margin-left:49px;width: 350px;">Nome*: <input id="name" style="width: 280px;"   type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;float: left;margin-left:10px;width: 186px;">RG*: <input id="rg" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-left:10px;width: 188px;float: left;">CPF*: <input id="cpf" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px;width: 253px;float: left;clear:left;">Data de Nasc.*: <input id="birth" type="text" class="text ui-widget-content ui-corner-all mandatory "> </label>
			<label style="display: block;margin-top: 15px; margin-left:134px;width: 200px;float: left;">
				Espec.*: <select id="spec"  style="width: 145px;" class="mandatory">
							<option selected="selected" value="-1">Selecione... </option>
							<option value="2">Ingl&ecirc;s Instrumental </option>
							<option value="b">bd </option>
						</select>
			</label>
			<label style="display: block;margin-top: 15px; margin-left:28px;width: 170px;float: left;">MEI: <input  id="mei" type="text" class="text ui-widget-content ui-corner-all"> </label>
			<label style="display: block;float: left;margin-top: 15px; margin-left:51px;width: 318px;clear: left;">Email*: <input id="email" style="width: 205px;" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px;margin-left:8px; width: 185px;float: left;">Telefone*: <input id="tel" style="width: 104px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:42px;width: 185px;float: left;">CEP*: <input  id="cep" style="width: 104px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;float: left;margin-top: 15px; margin-left:58px;width: 350px;clear: left;">End.*: <input id="end" style="width: 280px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:5px; width: 135px;float: left;">N&ordm;*: <input id="number" style="width: 40px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:44px;width: 157px;float: left;">Bairro*: <input id="neighborhood" style="width: 104px;" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:59px;float: left;clear: left;">OBS.:</label> <textarea id="obs" style="float: left;height: 40px;margin: 12px 0 20px 5px;width: 306px;" rows="" cols="" class="text ui-widget-content ui-corner-all"></textarea> 
			
			<div style=" margin: 15px auto auto;width: 134px;clear: left;">
				<input  type="button" value="Salvar" style="font-size: 10px;font-weight: bold;width: 63px;" onclick="edit();">
				<input type="button" value="Cancelar" style="font-size: 10px; font-weight: bold;width: 63px;" onclick="javascript:$('#fieldsetEdit').hide();$('#fieldsetCad').show('slide', 120);clearFields();">
			</div>
		</fieldset>
		
		<fieldset id="fieldsetEdit" class="fieldsetclass" style="display: none">
			<legend>Editar Professor</legend>
			
			<label style="display: block;float: left;margin-left:50px;width: 350px;">Nome*: <input id="nameEdit" style="width: 280px;"   type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;float: left;margin-left:10px;width: 186px;">RG*: <input id="rgEdit" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-left:10px;width: 188px;float: left;">CPF*: <input id="cpfEdit" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px;width: 253px;float: left;clear:left;">Data de Nasc.*: <input id="birthEdit" type="text" class="text ui-widget-content ui-corner-all mandatory "> </label>
			<label style="display: block;margin-top: 15px; margin-left:133px;width: 200px;float: left;">
				Espec.*:  <select id="specEdit"  style="width: 145px;" class="mandatory">
							<option selected="selected" value="-1">Selecione... </option>
							<option value="2">Ingl&ecirc;s Instrumental </option>
							<option value="b">bd </option>
						</select>
			
			</label>
			<label style="display: block;margin-top: 15px; margin-left:26px;width: 170px;float: left;">MEI: <input  id="meiEdit" type="text" class="text ui-widget-content ui-corner-all"> </label>
			<label style="display: block;float: left;margin-top: 15px; margin-left:54px;width: 318px;clear: left;">Email*: <input id="emailEdit" style="width: 205px;" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px;width: 185px;float: left;">Telefone*: <input id="telEdit" style="width: 104px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:49px;width: 185px;float: left;">CEP*: <input  id="cepEdit" style="width: 104px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;float: left;margin-top: 15px; margin-left:58px;width: 350px;clear: left;">End.*: <input id="endEdit" style="width: 280px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:5px; width: 135px;float: left;">N&ordm;*: <input id="numberEdit" style="width: 40px;"  type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:44px;width: 157px;float: left;">Bairro*: <input id="neighborhoodEdit" style="width: 104px;" type="text" class="text ui-widget-content ui-corner-all mandatory"> </label>
			<label style="display: block;margin-top: 15px; margin-left:59px;float: left;clear: left;">OBS.:</label> <textarea id="obsEdit" style="float: left;height: 40px;margin: 12px 0 20px 5px;width: 306px;" rows="" cols="" class="text ui-widget-content ui-corner-all"></textarea> 
			
			<div style=" margin: 15px auto auto;width: 134px;clear: left;">
				<input  type="button" value="Salvar" style="font-size: 10px;font-weight: bold;width: 63px;" onclick="edit();">
				<input type="button" value="Cancelar" style="font-size: 10px; font-weight: bold;width: 63px;" onclick="javascript:$('#fieldsetEdit').hide();$('#fieldsetCad').show('slide', 120);clearFields();">
			</div>
		</fieldset>
		
		<table id="tbteachers">
			<thead>
				<tr> 
					<th>Nome</th>
					<th>CPF</th>
					<th>Especialidade</th>
					<th>Email</th>
					<th>A&ccedil;&otilde;es</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td id='tdname0'>Eduardo Soares Silva </td>
					<td id="tdcpf0">11400683696 </td>
					<td>Ingl&ecirc;es Instrumental </td>
					<td id="tdemail0">essnato@gmail.com 
						<input id="tdid0" type="hidden" value="0" />
						<input id="tdrg0" type="hidden" value="MG15517873" />
						<input id="tdspec0" type="hidden" value="2" />
						<input id="tdbirth0" type="hidden" value="26/11/1989" />
						<input id="tdmei0" type="hidden" value="EHE7239EWYEW" />
						<input id="tdtel0" type="hidden" value="3432388676" />
						<input id="tdcep0" type="hidden" value="38414302" />
						<input id="tdend0" type="hidden" value="Rua Benedito Marra da Fonseca" />
						<input id="tdnumber0" type="hidden" value="225" />
						<input id="tdneighborhood0" type="hidden" value="Luizote" />
						<input id="tdobs0" type="hidden" value="Obs obsobsobsobsobsobsobs obs obs obs obs obs obs obs obs obs obs obs obs obs obs obs obs obs obs " />
					</td>
					<td>
						<a onclick="switchEdit(0)" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Editar" class="ui-icon ui-icon-pencil" style="margin-left: -7px;margin-top: -5px;"></span></a>
						<a onclick="del(${idx.index})" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Deletar" class="ui-icon ui-icon-trash" style="margin-left: -7px;margin-top: -5px;"></span></a>
					</td>
				</tr>
				<tr>
					<td>Alissa Alves de Oliveira Nato Teste </td>
					<td>11400683696 </td>
					<td>Ingl&ecirc;es Instrumental </td>
					<td>ddd@gmail.com </td>
					<td>
						<a onclick="switchEdit(${idx.index})" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Editar" class="ui-icon ui-icon-pencil" style="margin-left: -7px;margin-top: -5px;"></span></a>
						<a onclick="del(${idx.index})" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Deletar" class="ui-icon ui-icon-trash" style="margin-left: -7px;margin-top: -5px;"></span></a>
					</td>
				</tr>
				<c:forEach var="list" items="${listModules}" varStatus="idx">
					<tr>
						<td id="idtd${idx.index}"><fmt:formatNumber type="number" value="${list.id}" /></td>
						<td id="nametd${idx.index}">${list.name}</td>
						<td id="usertd${idx.index}"><input id="passtd${idx.index}" type="hidden" value="${list.password}" />${list.username}</td>
						<td>
							<a onclick="switchEdit(${idx.index})" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Editar" class="ui-icon ui-icon-pencil" style="margin-left: -7px;margin-top: -5px;"></span></a>
							<a onclick="del(${idx.index})" style="height:17px;width:26px;"  href="#" class="fg-button fg-button-icon-left ui-state-default ui-corner-all"><span title="Deletar" class="ui-icon ui-icon-trash" style="margin-left: -7px;margin-top: -5px;"></span></a>
						</td>
					</tr>
				</c:forEach>
		 	</tbody>
		</table>
		
		
	</div>

</tiles:putAttribute>

</tiles:insertTemplate>